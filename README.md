# uber_popug
**Проект для прохождения курса по асинхронной архитектуре**

Домашка #0 и Домашка #1:
Обе в одной миро борде (потому что нельзя бесплатно дать доступ в двум): https://miro.com/app/board/uXjVNtDepfs=/?share_link_id=441444066884
Разделены заголовками.

Картинкой часть по 1 домашке:

![Event storming](https://github.com/AATarasova/uber_popug/assets/26852748/23acdc24-12de-4818-ac52-34f4ce306d03)

Домены: 

![Данные и домены](https://github.com/AATarasova/uber_popug/assets/26852748/191d68d3-953d-4ad7-aed0-6be3d53f08e9)

Межсервисные коммуникации: 

![Связи между сервисами](https://github.com/AATarasova/uber_popug/assets/26852748/23dea621-7a8c-4a1e-8ee0-2189fb2eb5fe)

События:

![Бизнес-триггеры](https://github.com/AATarasova/uber_popug/assets/26852748/5e958f77-5f2f-4e93-9eba-64eb946702e7)

CUD:

![CUD](https://github.com/AATarasova/uber_popug/assets/26852748/8b55ce8f-b321-4803-a321-8e0ede535318)

Все схемы можно посмотреть также по ссылке https://drive.google.com/file/d/1FpqPVI0xdDXjk615LqemAw-4HJ38_l-I/view?usp=sharing

* Документация
Для запуска необходимо собрать в докере (важно! последовательно,с интервалом около 10 сек) zookeper и kafka. После этого можно запустить остальные сборки в docker-compose файле и получить досутп к кафке (полезно для отладки) по порту 9021  - это control-center.

Далее надо запустить все проекты: auth, dashboard и accounting. Все они лежат в отдельных солюшенах и имеют только один program-файл. Все обработчики событий (т.е. консюеры кафки) работают в отдельных потоках в фоновом режиме и не блокируют работу прииложений. Каждое приложение обладает своим сваггером (порт генерируется автоматически, см. логи). 

Чтобы вызвать апи, надо:
1) установить постман
2) прочекать порт auth
3) вызвать метод get token по кредам (если вы не создавали юзера - welcome в миграции EF для дефолтного юзера)
4) полученный токен как bearer tocken положить в postman ко всем остальным запросам.
Токен бессрочный, у вас полная свобода действий. Profit!
Права доступа проверяются по роли, которая лежит в claims jwt. Пользователь, который не имеет прав, получит 403 в ответ на запрос.

Если один из сервисов не запущен, он обработает все новые для него события после запуска с дефолтным delay после обработнных событий. 

